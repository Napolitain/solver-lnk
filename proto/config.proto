syntax = "proto3";

package config;

option go_package = "github.com/napolitain/solver-lnk/proto";

// Building types enum
enum BuildingType {
  BUILDING_UNKNOWN = 0;
  LUMBERJACK = 1;
  QUARRY = 2;
  ORE_MINE = 3;
  FARM = 4;
  WOOD_STORE = 5;
  STONE_STORE = 6;
  ORE_STORE = 7;
  KEEP = 8;
  ARSENAL = 9;
  LIBRARY = 10;
  TAVERN = 11;
  MARKET = 12;
  FORTIFICATIONS = 13;
}

// Technology types enum
enum Technology {
  TECH_UNKNOWN = 0;
  LONGBOW = 1;
  CROP_ROTATION = 2;
  YOKE = 3;
  CELLAR_STOREROOM = 4;
  STIRRUP = 5;
  CROSSBOW = 6;
  SWORDSMITH = 7;
  HORSE_ARMOUR = 8;
}

// Unit types enum
enum UnitType {
  UNIT_UNKNOWN = 0;
  SPEARMAN = 1;
  SWORDSMAN = 2;
  ARCHER = 3;
  CROSSBOWMAN = 4;
  HORSEMAN = 5;
  LANCER = 6;
  HANDCART = 7;
  OXCART = 8;
}

// Resource types enum
enum ResourceType {
  RESOURCE_UNKNOWN = 0;
  WOOD = 1;
  STONE = 2;
  IRON = 3;
  FOOD = 4;
}

// Building level in config
message BuildingLevel {
  BuildingType type = 1;
  int32 level = 2;
}

// Resource amount
message Resource {
  ResourceType type = 1;
  double amount = 2;
}

// Unit count
message UnitCount {
  UnitType type = 1;
  int32 count = 2;
}

// CastleConfig represents input configuration for castle solver
message CastleConfig {
  // Current building levels (ALL buildings must be specified)
  repeated BuildingLevel building_levels = 1;

  // Current resources
  repeated Resource resources = 2;

  // Already researched technologies
  repeated Technology researched_technologies = 3;
}

// UnitsConfig represents input configuration for units solver
message UnitsConfig {
  // Available food for units (default: 4265)
  int32 food_available = 1;

  // Resource production per hour (default: 1161)
  int32 resource_production_per_hour = 2;

  // Market distance in fields (default: 25)
  int32 market_distance_fields = 3;

  // Existing units (optional)
  repeated UnitCount existing_units = 4;
}

// Target levels for buildings
message TargetLevels {
  repeated BuildingLevel targets = 1;
}

// Request to solve castle build order
message SolveRequest {
  CastleConfig castle_config = 1;
  TargetLevels target_levels = 2;
}

// A single building upgrade action
message BuildingAction {
  BuildingType building_type = 1;
  int32 from_level = 2;
  int32 to_level = 3;
  int32 start_time_seconds = 4;
  int32 end_time_seconds = 5;
  repeated Resource costs = 6;
  int32 food_used = 7;
  int32 food_capacity = 8;
}

// A single research action
message ResearchAction {
  Technology technology = 1;
  int32 start_time_seconds = 2;
  int32 end_time_seconds = 3;
  repeated Resource costs = 4;
}

// Response from solver
message SolveResponse {
  // Full build order
  repeated BuildingAction building_actions = 1;
  repeated ResearchAction research_actions = 2;
  
  // Next immediate action to execute (first in list)
  BuildingAction next_action = 3;
  
  // Total time to complete all targets (seconds)
  int32 total_time_seconds = 4;
  
  // Strategy used
  string strategy = 5;
}

// Castle Solver Service
service CastleSolverService {
  // Solve returns the optimal build order for a castle
  rpc Solve(SolveRequest) returns (SolveResponse);
  
  // GetNextAction returns only the next immediate action (lightweight)
  rpc GetNextAction(SolveRequest) returns (BuildingAction);
}
